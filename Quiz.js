var currentQuiz,quizInfo,currentQ,quizIDs=null===localStorage.getItem("IDs")?[]:JSON.parse(localStorage.getItem("IDs")),good=[],okay=[],meh=[];function remove(e){for(var n=document.getElementsByClassName(e);n[0];)n[0].parentNode.removeChild(n[0])}function removeEvListeners(e){var n=document.getElementById(e),t=n.cloneNode(!0);n.parentNode.replaceChild(t,n)}function random(e){return Math.floor(Math.random()*e)}function completed(){quizInfo.complete=!0,localStorage.setItem(quizInfo.ID,JSON.stringify(quizInfo)),window.confirm("You're done! Do you want to continue?")?(good=[],okay=[],meh=[],quizInfo.complete=!1,localStorage.setItem(quizInfo.ID,JSON.stringify(quizInfo))):reload()}function changeArray(e,n){n?meh.indexOf(e)>-1?(okay.push(e),meh.splice(meh.indexOf(e),1)):okay.indexOf(e)>-1?(good.push(e),okay.splice(okay.indexOf(e),1)):good.indexOf(e)>-1&&good.length===quizInfo.aArray.length?completed():-1===good.indexOf(e)&&meh.push(e):meh.indexOf(e)>-1?meh.splice(meh.indexOf(e),1):okay.indexOf(e)>-1?(meh.push(e),okay.splice(okay.indexOf(e),1)):good.indexOf(e)>-1&&(okay.push(e),good.splice(good.indexOf(e),1))}function simplifyStr(e){return e.toLocaleLowerCase().replace(/,/g,"").replace(/\s\s+/g," ")}function reload(){if(void 0!==quizInfo){var e=JSON.parse(localStorage.getItem(quizInfo.ID));e.good=good,e.okay=okay,e.meh=meh,console.log(quizInfo.ID,e),localStorage.setItem(quizInfo.ID,JSON.stringify(e))}remove("quizBtn"),document.getElementById("createNew").style.display="none",document.getElementById("quiz").style.display="none",document.getElementById("menu").style.display="initial",document.getElementById("name").value="",document.getElementById("text").value="",0===quizIDs.length&&(document.getElementById("noQuizzes").style.display="initial"),console.log(quizIDs),quizIDs.forEach(function(e){loadQuizzes(e)})}function loadQuizzes(e){document.getElementById("noQuizzes").style.display="none";var n=document.createElement("button");n.className="quizBtn",n.innerHTML=JSON.parse(localStorage.getItem(e)).complete?JSON.parse(localStorage.getItem(e)).name+" (Done)":JSON.parse(localStorage.getItem(e)).name,n.style="width: 40%; height: 100px; font-size: 20px",n.addEventListener("click",function(){startQuiz(e)}),document.getElementById("menu").appendChild(document.createElement("br")),document.getElementById("menu").appendChild(n)}function newQuiz(){document.getElementById("createNew").style.display="initial",document.getElementById("menu").style.display="none",document.getElementById("quiz").style.display="none"}function saveQuiz(){if(""!==document.getElementById("text").value.replace(/\n/g,""))if(""!==document.getElementById("name").value.replace(/\n/g,"")){var e=quizIDs.length>0?quizIDs[quizIDs.length-1]+1:1,n=document.getElementById("name").value,t=[],o=[];document.getElementById("text").value.split(/\n/g).filter(function(e){return e.replace(/\s/g,"")}).forEach(function(e){var n=e.split("==");t.push(n[0].trim()),o.push(n[1].trim())});if(-1!==t.indexOf("")){if(!confirm("You haven't entered a question somewhere, are you sure you want to save this quiz?"))return}else if(-1!==o.indexOf("")&&!confirm("You haven't entered an answer somewhere, are you sure you want to save this quiz?"))return;quizIDs.push(e);var i={ID:e,name:n,qArray:t,aArray:o};localStorage.setItem(e,JSON.stringify(i)),localStorage.setItem("IDs",JSON.stringify(quizIDs)),reload()}else window.alert("You haven't given your quiz a name");else window.alert("You haven't entered anything")}function startQuiz(e){void 0!==(quizInfo=JSON.parse(localStorage.getItem(e))).good?(good=quizInfo.good,okay=quizInfo.okay,meh=quizInfo.meh):(good=[],okay=[],meh=[]),document.getElementById("createNew").style.display="none",document.getElementById("menu").style.display="none",document.getElementById("quiz").style.display="initial",quizQuestion(e)}function pickQuestion(){if(0===good.length&&0===okay.length&&0===meh.length)return random(quizInfo.qArray.length);var e=random(1e5);return e<1e4?0!==random(good.length)?random(good.length-1):pickQuestion():e<3e4?0!==random(okay.length)?random(okay.length-1):pickQuestion():e<6e4?0!==random(meh.length)?random(meh.length-1):pickQuestion():random(quizInfo.aArray.length)}function quizQuestion(e){currentQ=pickQuestion(),document.getElementById("question").innerHTML=quizInfo.qArray[currentQ],document.getElementById("submit").addEventListener("click",function(){removeEvListeners("input"),checkAnswer(currentQ,e)},{once:!0}),document.getElementById("input").addEventListener("keyup",function(n){"Enter"===n.key&&(removeEvListeners("submit"),removeEvListeners("input"),checkAnswer(currentQ,e))})}function checkAnswer(e,n){simplifyStr(quizInfo.aArray[e])===simplifyStr(document.getElementById("input").value)?(alert("Correct!"),changeArray(e,!0)):(alert("Wrong! The answer was '"+quizInfo.aArray[e]+"'"),changeArray(e,!1)),document.getElementById("input").value="",document.getElementById("input").focus(),quizQuestion(n)}
